<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Alfa Bank</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="vendors/iconfonts/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">
  <!-- endinject -->

  <!-- inject:css -->
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
  <!-- endinject -->
  <link rel="shortcut icon" href="images/favicon.png" />
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.4/firebase-app.js"></script>
   <script src="https://www.gstatic.com/firebasejs/6.3.4/firebase-database.js"></script>
   <script src="https://www.gstatic.com/firebasejs/6.3.4/firebase.js"></script>
   <script type="text/javascript">
    function showCode(){
      var checkCode = document.getElementById("editcode");
      var hiddeninputs = document.getElementsByClass("hidden");

      for(var i=0;i!=hiddeninputs.length;i++){
        if(checkCode.checked){
          hiddeninputs[i].style.display="inline";
        }
        else{
          hiddeninputs[i].style.display="none";
        }
      }
    }
  </script>
</head>
<body>
  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="home.html"><img src="images/f8275003f69d79861b10e7d4ec1560bc.png" alt="logo"/></a>
        <a class="navbar-brand brand-logo-mini" href="home.html"><img src="images/logo-mini.svg" alt="logo"/></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item d-none d-lg-block full-screen-link">
            <a class="nav-link">
              <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
            </a>
          </li>
          <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" href="index.html">
              <i class="mdi mdi-power"></i>
            </a>
          </li>
          <li class="nav-item nav-settings d-none d-lg-block">
            <a class="nav-link" href="#">
              <i class="mdi mdi-format-line-spacing"></i>
            </a>
          </li>
        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item nav-profile">
            <a href="#" class="nav-link">
              <div class="nav-profile-image">
                <img src="images/Fotolia_188161178_XS-6.jpg" alt="profile">
                <span class="login-status online"></span> <!--change to offline or busy as needed-->              
              </div>
              <div class="nav-profile-text d-flex flex-column">
                <span class="font-weight-bold mb-2">Админ</span>
                <span class="text-secondary text-small">Альфа Банка</span>
              </div>
              <i class="mdi mdi-bookmark-check text-success nav-profile-badge"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="home.html">
              <span class="menu-title">Главное меню</span>
              <i class="mdi mdi-home menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="pages/charts/chartjs.html">
              <span class="menu-title">Статистка</span>
              <i class="mdi mdi-chart-bar menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="pages/tables/basic-table.html">
              <span class="menu-title">Таблица</span>
              <i class="mdi mdi-table-large menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="pages/tables/message.html">
                <span class="menu-title">Сообщения</span>
                <i class="mdi mdi-format-list-bulleted menu-icon"></i>
              </a>
            </li>
        </ul>
      </nav>
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
         <div class="page-header">
            <h3 class="page-title">
              <span class="page-title-icon bg-gradient-primary text-white mr-2">
                <i class="mdi mdi-home"></i>                 
              </span>
              Главное меню
            </h3>
          </div>
          <div class="row">
            <div class="col-md-4 stretch-card grid-margin">
              <div class="card bg-gradient-danger card-img-holder text-white">
                <div class="card-body">
                  <img src="images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image"/>
                  <h4 class="font-weight-normal mb-3">Кол-во Сотрудников
                    <i class="mdi mdi-account-card-details"></i>
                  </h4>
                  <h2 class="mb-5" id="object"></h2>
                </div>
              </div>
            </div>
            <div class="col-md-4 stretch-card grid-margin">
              <div class="card bg-gradient-info card-img-holder text-white">
                <div class="card-body">
                  <img src="images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image"/>                  
                  <h4 class="font-weight-normal mb-3">Кол-во Комментов
                    <i class="mdi mdi-comment-text-outline"></i>
                  </h4>
                  <h2 class="mb-5" id="comment"></h2>
                </div>
              </div>
            </div>
            <div class="col-md-4 stretch-card grid-margin">
              <div class="card bg-gradient-success card-img-holder text-white">
                <div class="card-body">
                  <img src="images/dashboard/circle.svg" class="card-img-absolute" alt="circle-image"/> 
                  <input type="button" class="editbutton" id="editcode" onсlick="showCode()" value="Edit" style="float:right;" />
                  <!--   
                  <br>
                  <label class="hidden">New Code:</label>
                  <input type="text" name="name" class="hidden" />       -->                     
                  <h4 class="font-weight-normal mb-3">Код :
                    <i class="mdi mdi-barcode-scan" style="margin-left: 15px;"></i>

                  </h4>
                  <h2 class="mb-5" id="code"></h2>
                  
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-7 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <div class="clearfix">
                    <h4 class="card-title float-left">Настроений Сотрудников за последнюю неделю</h4>
                    <div id="visit-sale-chart-legend" class="rounded-legend legend-horizontal legend-top-right float-right"></div>                                     
                  </div>
                  <canvas id="visit-sale-chart" class="mt-4"></canvas>
                </div>
              </div>
            </div>
            <div class="col-md-5 grid-margin stretch-card">
              <div class="card">
                
                <div class="card-body">
                  	<div class="date-picker" style="height:30px;border: 1px solid black;border-radius: 7px;">
                        <div class="selected-date" ></div>
                    
                        <div class="dates" style="border: 1px solid black;">
                          <div class="month">
                            <div class="arrows prev-mth">&lt;</div>
                            <div class="mth"></div>
                            <div class="arrows next-mth">&gt;</div>
                          </div>
                    
                          <div class="days"></div>
                          <!-- <button onclick="initAnotherGraph()">Выбрать</button> -->
                        </div>
                      </div>
                  <h4 class="card-title" style="text-align: center;">Настроение Сотрудников</h4>
                  <canvas id="chart" width="400" height="400"></canvas>
                  <div id="traffic-chart-legend" class="rounded-legend legend-vertical legend-bottom-left pt-4"></div>                                                      
                </div>
              </div>
            </div>
          </div>

          <div class="template-demo mt-2" style="margin-bottom: 20px; text-align: center;">
              <button class="btn btn-outline-dark btn-icon-text">
                <i class="mdi mdi-apple btn-icon-prepend mdi-36px"></i>
                <span class="d-inline-block text-left">
                  <small class="font-weight-light d-block">Можно скачать в</small>
                  App Store
                </span>
              </button>
              <button class="btn btn-outline-dark btn-icon-text">
                <i class="mdi mdi-android-debug-bridge btn-icon-prepend mdi-36px"></i>
                <span class="d-inline-block text-left">
                  <small class="font-weight-light d-block">Можно скачать в</small>
                  Google Play
                </span>
              </button>
            </div>
            
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Alfa Bank © 2019</span>
            <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">С любовью Method Pro ;) <i class="mdi mdi-heart text-danger"></i></span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->


  <!-- plugins:js -->
  <script src="vendors/js/vendor.bundle.base.js"></script>
  <script src="vendors/js/vendor.bundle.addons.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page-->
  <!-- End plugin js for this page-->
  <!-- inject:js -->
  <script src="js/off-canvas.js"></script>
  <script src="js/misc.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="js/dashboard.js"></script>
  <script src="js/chart.js"></script>
  <!-- End custom js for this page-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<!-- Add Firebase products that you want to use -->
<script src="node_modules/moment/min/moment.min.js"></script>

<script type="text/javascript"> 

const date_picker_element = document.querySelector('.date-picker');
const selected_date_element = document.querySelector('.date-picker .selected-date');
const dates_element = document.querySelector('.date-picker .dates');
const mth_element = document.querySelector('.date-picker .dates .month .mth');
const next_mth_element = document.querySelector('.date-picker .dates .month .next-mth');
const prev_mth_element = document.querySelector('.date-picker .dates .month .prev-mth');
const days_element = document.querySelector('.date-picker .dates .days');

const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

let date = new Date();
let day1 = date.getDate();
let month = date.getMonth();
let year = date.getFullYear();

let selectedDate = date;
let selectedDay = day1;
let selectedMonth = month;
let selectedYear = year;

mth_element.textContent = months[month] + ' ' + year;

selected_date_element.textContent = formatDate(date);
selected_date_element.dataset.value = selectedDate;

populateDates();

// EVENT LISTENERS
date_picker_element.addEventListener('click', toggleDatePicker);
next_mth_element.addEventListener('click', goToNextMonth);
prev_mth_element.addEventListener('click', goToPrevMonth);

// FUNCTIONS
function toggleDatePicker (e) {
	if (!checkEventPathForClass(e.path, 'dates')) {
		dates_element.classList.toggle('active');
	}
}

function goToNextMonth (e) {
	month++;
	if (month > 11) {
		month = 0;
		year++;
	}
	mth_element.textContent = months[month] + ' ' + year;
	populateDates();
}

function goToPrevMonth (e) {
	month--;
	if (month < 0) {
		month = 11;
		year--;
	}
	mth_element.textContent = months[month] + ' ' + year;
	populateDates();
}

function populateDates (e) {
	days_element.innerHTML = '';
	let amount_days = 31;

	if (month == 1) {
		amount_days = 28;
	}

	for (let i = 0; i < amount_days; i++) {
		const day_element = document.createElement('div');
		day_element.classList.add('day');
		day_element.textContent = i + 1;

		if (selectedDay == (i + 1) && selectedYear == year && selectedMonth == month) {
      day_element.classList.add('selected');
      setTimeout(() => {initAnotherGraph(day_element.innerHTML)}, 100);
		}

		day_element.addEventListener('click', function () {
			selectedDate = new Date(year + '-' + (month + 1) + '-' + (i + 1));
			selectedDay = (i + 1);
			selectedMonth = month;
			selectedYear = year;

			selected_date_element.textContent = formatDate(selectedDate);
			selected_date_element.dataset.value = selectedDate;

			populateDates();
		});

		days_element.appendChild(day_element);
	}
}

// HELPER FUNCTIONS
function checkEventPathForClass (path, selector) {
	for (let i = 0; i < path.length; i++) {
		if (path[i].classList && path[i].classList.contains(selector)) {
			return true;
		}
	}
	
	return false;
}
function formatDate (d) {
	let day1 = d.getDate();
	if (day1 < 10) {
		day1 = '0' + day1;
	}

	let month = d.getMonth() + 1;
	if (month < 10) {
		month = '0' + month;
	}

	let year = d.getFullYear();
    let m=selectedMonth;
    return  months[m]+' ' + day1 +' ' + year;
    
}
var firebaseConfig = {
    apiKey: "AIzaSyABQone9FZrj8WlXoGCypEhU9WReO_PPOc",
    authDomain: "alphamood-842eb.firebaseapp.com",
    databaseURL: "https://alphamood-842eb.firebaseio.com",
    projectId: "alphamood-842eb",
    storageBucket: "alphamood-842eb.appspot.com",
    messagingSenderId: "527194776177"
    };
    firebase.initializeApp(firebaseConfig);
    ///////////////////////////////////КОД:///////////////////////////////////////
    var preObjectCode = document.getElementById('code');
    var dbRefObjectCode=firebase.database().ref().child('Security');
    var dbRefObjectCodeId = dbRefObjectCode.child('Code');
    dbRefObjectCodeId.on('value',snap => preObjectCode.innerText = snap.val());
    ///////////////////////////количество комментов////////////////////////////////
    var preObjectComId = document.getElementById('comment');
    var dbRefObjectCom=firebase.database().ref().child('Tue Aug 06 2019');
    var dbRefObjectComment = dbRefObjectCom.child('Comments');
    dbRefObjectComment.on('value',snap => preObjectComId.innerText = snap.val());
    ///////////////////////////////////////////////////////////////////////////////
    ////////////////////////////количество сотрудников/////////////////////////////
    var preObject = document.getElementById('object');
    var dbRefObject=firebase.database().ref().child('limits');
    var dbRefObject3 = dbRefObject.child('num');
    dbRefObject3.on('value',snap => preObject.innerText = snap.val());
       ///////////////////////////////////////////////////////////////////////////////
    ////////////////////////////количество сотрудников/////////////////////////////
    console.log();
    var preObject = document.getElementById('object');
    var dbRefObject=firebase.database().ref().child('limits');
    var dbRefObject3 = dbRefObject.child('num');
    dbRefObject3.on('value',snap => preObject.innerText = snap.val());
    //////////////////////////////////////////////////////////////////////////////
    var day =(moment().format('MMM DD YYYY'));
    console.log(moment().format('ddd MMM DD YYYY'));
    ////////////////////////////////////////////////////////////////////////////////
    console.log(selected_date_element.textContent);
    var dayrel = selected_date_element.textContent;

    ///////////////////////////////Настроение сотрудников///////////////////////////
    function initAnotherGraph(day) {
      if (typeof day === 'undefined') {
        return false;
      }

      let selectedDay = document.querySelector('.day.selected').innerText;
      let monthAndYear = document.querySelector('.mth').innerText;
      let month = monthAndYear.split(' ')[0];
      let year  = monthAndYear.split(' ')[1];
      let newDate = month + ' ' + selectedDay + ' ' + year;

      let date = moment(`${year}-${month}-${selectedDay}`);
      let dayOfWeek = date.format('ddd');

      if (parseInt(selectedDay) < 10) {
        selectedDay = '0' + selectedDay;
      }

      let filteredDate = `${dayOfWeek} ${month} ${selectedDay} ${year}`;
      firebase.database().ref(filteredDate).child("Bad").on('value', function(ss) {
        console.log(filteredDate, 'filteredDate');
          var x2 = ss.val();
          firebase.database().ref(filteredDate).child("Medium").on('value',function(ss1){
            var x3 = ss1.val();
            firebase.database().ref(filteredDate).child("Good").on('value',function(ss2){
            var x1 = ss2.val();
            var ctx =document.getElementById("chart");
            var myChart= new Chart(ctx, {
              type: 'doughnut',
              data: {
                labels: ["Плохое", "Среднее", "Хорошее"],
                datasets: [{
                  label: "Population (millions)",
                  backgroundColor: ["#F53134", "#D6DB32","#67ED42"],
                  data: [x2,x3,x1]
                }]
              },
              options: {
                title: {
                  display: true,
                }
              }
            });
          });
        });
     });
    }
</script>
<style>
h1 {
	margin: 30px 0px;
	color: #313131;
	font-size: 42px;
	font-weight: 900;
	text-align: center;
}

h1 span {
	font-weight: 300;
}

.date-picker {
	position: relative;
	width: 100%;
	max-width: 320px;
	height: 60px;
	background-color: #FFF;
	margin: 30px auto;
	box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.2);

	cursor: pointer;
	user-select: none;
}

.date-picker:hover {
	background-color: #F3F3F3;
}

.date-picker .selected-date {
	width: 100%;
	height: 100%;

	display: flex;
	justify-content: center;
	align-items: center;

	color: #313131;
	font-size: 28px;
}

.date-picker .dates {
	display: none;
	position: absolute;
	top: 100%;
	left: 0;
	right: 0;

	background-color: #FFF;
}

.date-picker .dates.active {
	display: block;
}

.date-picker .dates .month {
	display: flex;
	justify-content: space-between;
	align-items: center;
	border-bottom: 2px solid #EEE;
}

.date-picker .dates .month .arrows {
	width: 35px;
	height: 35px;
	display: flex;
	justify-content: center;
	align-items: center;
	color: #313131;
	font-size: 20px;
}

.date-picker .dates .month .arrows:hover {
	background-color: #F3F3F3;
}

.date-picker .dates .month .arrows:active {
	background-color: #00CA85;
}

.date-picker .dates .days {
	display: grid;
	grid-template-columns: repeat(7, 1fr);
	height: 200px;
}
.date-picker .dates .days .day { 
	display: flex;
	justify-content: center;
	align-items: center;
	color: #313131;
}
.date-picker .dates .days .day.selected {
	background-color: #00CA85;
}
</style>
</body>
</html>